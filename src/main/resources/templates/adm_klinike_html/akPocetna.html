<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Poƒçetna strana</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  		<style>
  		html, body {
	    	width: 100%;
		}
		#tabela {margin: 0 auto;}
	</style>
  	<script>
	  	$(document).ready( function() {
			document.getElementById('date').valueAsDate  = new Date();
		});
  	</script>
  	</head>
<body>
	<div id = "admin">
		<div id = "nav">
		<nav class="navbar navbar-inverse">
			<div class="container-fluid">
		    	<ul class="nav navbar-nav">
					<li><a class="navbar-brand" v-on:click="pregledi">Nezakazani pregledi</a></li>			      	
			    </ul>
		    	<ul class="nav navbar-nav navbar-right">
		      		<li><a v-on:click="log_out_k"><span class="glyphicon glyphicon-log-in"></span> Logout</a></li>
		    	</ul>
	  		</div>
		</nav>
		</div>
		<login-component></login-component>
		<div th:replace="adm_klinike_html/NezakazaniPregledi :: nezakazani"></div>
		<div th:replace="adm_klinike_html/Pregled :: modalP"></div>
		<div th:replace="adm_klinike_html/PreglediIzmeniDatum :: modalPreglediIspravka"></div>
	</div>
</body>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://vuejs.org/js/vue.js"></script>
<script src="/js/script.js"></script>


<script>

	var app = new Vue({
		el: '#admin',
		data: {
			npregledi:[],
			columns: [],
			labels: [],
			sale: [],
			termini: [],
			selected: '',
			selected_datum: '',
			selected_time: '',
			item: {}
		},
		mounted() {
			this.proveri_preglede();
		},
		methods: {
			isLoggedIn(){
                return window.Event.isLoggedIn;
            },
            log_out_k(){
            	this.$root.$emit('logged-out')
            	//Event.$emit('logged-out');
            },
            proveri_preglede(){
            	axios({
                	method : 'post',
                    url : 'api/adminKlinike/proveri_preglede' + '?access_token=' + getCookie("access_token"),
                });
            },
            pregledi(){
            	this.hideAll();
            	axios({
                	method : 'get',
                    url : 'api/adminKlinike/pregledi' + '?access_token=' + getCookie("access_token"),
                }).then(function(response){
                    this.npregledi = response.data;
                    this.columns = [ 'datum', 'imeP', 'prezimeP', 'tipOp', 'vremeOd'];
                    this.labels = [ 'Datum', 'Lekar', '','Tip', 'Vreme'];
                    console.log(this.npregledi[0]);
                    $( "#nezakazani" ).show();
                }.bind(this));
            },
            hideAll(){
            	$( "#nezakazani" ).hide();
            	$( "#modalPregledi" ).hide();
            	$( "#modalPreglediIzmena" ).hide();
            },
            pregled_sale(id, index){
            	alert(id);
            	for(pregled of this.npregledi){
					if(pregled['id'] == id)
					{
						this.item = pregled;
					}
				}
            	axios({
                	method : 'post',
                    url : 'api/adminKlinike/sale' + '?access_token=' + getCookie("access_token"),
                    data:this.item
                }).then(function(response){
                    this.sale = response.data;
                    $( "#modalPregledi" ).show();
                    //$( "#modalPreglediIzmena" ).show();
                }.bind(this)).catch((error)=>{
                	$( "#modalPreglediIzmena" ).show();
                });
            },
            zakazi_Pregled(){
            	alert(this.selected);
            	this.item['sala'] = this.selected['naziv'];
            	axios({
                	method : 'post',
                    url : 'api/adminKlinike/zakazi_pregled'+ '?access_token=' + getCookie("access_token"),
                    data : this.item
                }).then(function(response){
                	document.location.replace("/akPocetna");
                });
            },
            datum(){
            	alert($("#date").val());
            	this.item['datum'] = $("#date").val()
            	axios({
            		method : 'post',
                    url : 'api/adminKlinike/sale'+ '?access_token=' + getCookie("access_token"),
                    data : this.item
                }).then(function(response){                	
                	this.sale = response.data;
                	$( "#modalPreglediIzmena" ).show();
                }.bind(this));
            	
            	axios({
            		method : 'post',
                    url : 'api/adminKlinike/termini'+ '?access_token=' + getCookie("access_token"),
                    data : {ime: this.item['imeP'], prezime: this.item['prezimeP'], datum: this.item['datum']}
                }).then(function(response){                	
                	this.termini = response.data;
                	$( "#modalPreglediIzmena" ).show();
                }.bind(this));
            },
            zakazi_izmenjen(){
            	this.item['datum'] = this.selected_datum;
            	this.item['vremeOd'] = this.selected_time;
            	this.item['sala'] = this.selected['naziv'];
            	axios({
            		method : 'post',
                    url : 'api/adminKlinike/zakazi_pregled'+ '?access_token=' + getCookie("access_token"),
                    data : {id:this.item['id'] ,imeP: this.item['imeP'], prezimeP: this.item['prezimeP'], datum: this.item['datum'], vremeOd:this.item['vremeOd'], sala: this.item['sala'], cena: this.item['cena'], vremeDo: this.item['vremeDo'], tipOp : this.item['tipOp'], izvrsen: this.item['izvrsen']}
                }).then(function(response){                	
                	document.location.replace("/akPocetna");
                }.bind(this));
            }
		}
		});
	
	</script>
</html>